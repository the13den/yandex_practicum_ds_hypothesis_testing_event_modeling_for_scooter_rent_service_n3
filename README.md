# О работе "Статистический анализ данных. Проверка гипотез и моделирование событий для сервиса по прокату самокотов"

Вначале работы у нас было три таблицы с данными сервиса по прокату самокатов. Я предобработал данные, объединил таблицы с помощью Pandas. Провел исследовательский анализ с помощью matplotlib, seaborn, plotly. В конце с помощью scipy проверил ряд гипотез, смоделировал несколько событий. Дал рекомендации для бизнеса.

Технологии: Python, pandas, matplotlib, seaborn, plotly, scipy

# Вывод по работе, написанный в конце файла .ipynb
**Цель работы:**

Проанализировать предоставленные данные и выявить: частоту встречаемости городов, соотношение пользователей с подпиской и без, возраст пользователей, взглянуть на расстояние одной поездки (найти минимальное, максимальное, медианное), взглянуть на продолжительность поездок. Кроме этого необходимо проверить гипотезы

###! Могу написать лучше, текст в идеале нужно причесать и превратить сухую информацию в художественное произведение

**Гиппотезы**

Шаг 6. Проверка гипотез
Продакт-менеджеры сервиса хотят увеличить количество пользователей с подпиской. Для этого они будут проводить различные акции, но сначала нужно выяснить несколько важных моментов. 

6.1 Важно понять, тратят ли пользователи с подпиской больше времени на поездки? Если да, то пользователи с подпиской могут быть «выгоднее» для компании. Проверьте гипотезу. Используйте исходные данные о продолжительности каждой сессии — отдельно для подписчиков и тех, у кого нет подписки. 

6.2 Расстояние одной поездки в
3130 метров — оптимальное с точки зрения износа самоката. Можно ли сказать, что среднее расстояние, которое проезжают пользователи с подпиской за одну поездку, не превышает
3130 метров? Проверьте гипотезу и сделайте выводы. 

6.3 Проверьте гипотезу о том, будет ли помесячная выручка от пользователей с подпиской по месяцам выше, чем выручка от пользователей без подписки. Сделайте вывод. 

6.4 Представьте такую ситуацию: техническая команда сервиса обновила сервера, с которыми взаимодействует мобильное приложение. Она надеется, что из-за этого количество обращений в техподдержку значимо снизилось. Некоторый файл содержит для каждого пользователя данные о количестве обращений до обновления и после него. Какой тест вам понадобился бы для проверки этой гипотезы? 

**Шаг 7 (необязательное задание). Распределения**
7.1 Отделу маркетинга GoFast поставили задачу: нужно провести акцию с раздачей промокодов на один бесплатный месяц подписки, в рамках которой как минимум
100 существующих клиентов должны продлить эту подписку. То есть по завершении периода действия подписки пользователь может либо отказаться от неё, либо продлить, совершив соответствующий платёж.
Эта акция уже проводилась ранее и по итогу выяснилось, что после бесплатного пробного периода подписку продлевают
10 % пользователей. Выясните, какое минимальное количество промокодов нужно разослать, чтобы вероятность не выполнить план была примерно
5 %. Подберите параметры распределения, описывающего эту ситуацию, постройте график распределения и сформулируйте ответ на вопрос о количестве промокодов. 
 
7.2 Отдел маркетинга рассылает клиентам push-уведомления в мобильном приложении. Клиенты могут открыть его или не открывать. Известно, что уведомления открывают около
40 % получивших клиентов. Отдел планирует разослать
1 млн уведомлений. С помощью аппроксимации постройте примерный график распределения и оцените вероятность того, что уведомление откроют не более
399,5 тыс. пользователей.


Работа состояла из нескольких этапов:
1. Подключение библиотек
2. Знакомство с данными
3. Предобработка данных
4. Удаление выбросов
5. Создание новых признаков
6. Исследовательский анализ данных
7. Объединение данных data_rides и data_users. Создание датасета, где каждой поездке приписана полная информация о пользователе и о подписке
9. Анализ длительности и расстояния поездки в зависимости от подписки
10. Создание датафрейма, где для каждого пользователя указано, какое суммарное расстояние, количество поездок, суммарное время поездок было сделано пользователем за месяц, а также указано сколько денег он принес
11. Проверка гипотез
12. Проверка вероятностей успеха двух событий: акции "Бесплатная подписка 30 дней" и открытия пуша более 399,5 тысячами пользователей
## Подключение библиотек
Подключили все необходимые библиотеки
## Знакомство с данными
Файл users_go.csv содержит 1565 записей о пользователях

user_id - уникальный идентификатор пользователя
name - имя пользователя
age - возраст
city - город subscription_type - тип подписки (free, ultra)

Файл rides_go.csv содержит 18068 записи о поездках

user_id - уникальный идентификатор пользователя
distance - расстояние, которое пользователь проехал в текущей сессии (в метрах)
duration - продолжительность сессии (в минутах) — время с того момента, как пользователь нажал кнопку «Начать поездку» до момента, как он нажал кнопку «Завершить поездку»
date - дата совершения поездки

Файл subscriptions_go.csv содержит информацию о двух подписках

subscription_type - тип подписки  
minute_price - стоимость одной минуты поездки по данной подписке 
start_ride_price - стоимость начала поездки 
subscription_fee - стоимость ежемесячного платежа


Данные даны за период с 2021-01-01 по 2021-12-30

Большая часть данных достаточна полная, не имеет аномалий. 


Строки в таблицах выглядят нормально. Однако хорошей практикой было бы устранить возможность неявных дубликатов по столбцам name из data_users путем приведения к нижнему регистру, удаления пробелов и знаков препинания (хотя предварительно их не видно), смены е (йо) на е.

Есть несколько проблем:
1) Есть слишком короткие поездки в `data_rides`
2) Странно, что пользователи привлеченные позже, чаще пользуются сервисом. Возможно ранним пользователям сервис не понравился, а потом произошло координальное изменение. Либо сервис появился в других городах.
3) Почему-то зимой не наблюдается спада в поездках


## Предобработка данных
**"Смена типа данных"**

В столбцах `data_rides` была произведена смена типов данных. 
- Столбцы `distance` (математическое округление) и `duration` (округление) были приведены к целочисленному типу данных. 
- Столбец `date` был преобразован в тип данных datetime.


**"Удаление пропусков"** 

Явные и неявные пропуски не были найдены

**"Удаление дубликатов"** 

В ходе работы удалено 31 строчки явных дубликатов из data_users. 

Так как это учебный проект удаление неявных дубликатов опущено для ускорения работы
## Удаление выбросов
Удаление выбросов не входит в задание, поэтому для ускорения своего обучения я опустил. Ознакомится с методикой удаления выбросов можно в других моих работах
## Создание новых признаков
В датафрем `data_rides` добавили новый столбец с номером месяца, в который совершена поездка `ride_month`
## Исследовательский анализ данных
Был проведен ряд наблюдений, ниже их результат

**Вывод раздела "Исследование частоты встречаемости городов зарегистрированных пользователей"**  ¶

- Все города встречаются примерно одинаково часто.
- Самый редкий город Москва 11%
- Самый частый город Пятигорск 14.3%.
- Всего городов 8 (Пятигорск, Екатеринбург, Ростов-на-Дону, Краснодар, Сочи, Омск, Тюмень, Москва)

**Вывод раздела "Выявление соотношения числа пользователей с подпиской и без"**  

Всего в сервисе 1534 пользователей, из них 54.4% (835) не имеют подписку, 45.6% (699) имеют подписку

**Вывод раздела "Исследование возрастов пользователей"**  

- Всего в сервисе 1534 пользователя
- Примерно 4% пользователей это люди от 12 до 17 лет
- Примерно 34% пользователей это люди от 18 до 24 лет
- Примерно 59% пользователей это люди от 25 до 34 лет
- Примерно 3% пользователей это люди от 34 до 44 лет

**Вывод раздела "Исследование расстояния одной поездки"**  

- Всего за период 2021-01-01 по 2021-12-30 было совершено 18068 поездок
- Минимальное расстояние поездки 0 метров
- Максимальное расстояние поездки 7211 метров
- Поездки до 1000 метров занимают примерно 7% от количества всех поездок
- Поездки от 1000 до 2000 метров занимают примерно 6% от всего количества поездок
- Поездки от 2000 до 3000 метров занимают примерно 31% от всего количества поездок
- Поездки от 3000 до 4000 метров занимают примерно 36% от всего количества поездок
- Поездки от 4000 до 5000 метров занимают примерно 17% от всего количества поездок
- Поездки от 5000 до 6000 метров занимают примерно 3% от всего количества поездок
- Поездки от 6000 до 7000 метров занимают менее 1% от всего количества поездок

**Вывод раздела "Исследование длительности одной поездки"**  

- Всего за период 2021-01-01 по 2021-12-30 было совершено 18068 поездок
- Самая короткая поездка в сервисе была закончена за минуту, самая длиная за 41 минуту
- Поездки короче 5 минут занимают менее 1% от всех поездок
- Поездки от 5 до 10  минут занимают около 5% от всех поездок
- Поездки от 10 до 15  минут занимают около 22% от всех поездок
- Поездки от 15 до 20 минут занимают около 31% от всех поездок
- Поездки от 20 до 25 минут занимают около 27% от всех поездок
- Поездки от 25 до 30 минут занимают около 11% от всех поездок
- Поездки от 30 до 35 минут занимают около 5% от всех поездок
- Поездки от 35 до 40 минут занимают менее 1% от всех поездок
- В 50% случаев поездки совершаются длительностью от 10 до 20 минут, в 38% случаев от 20 до 30 минут
## Объединение данных data_rides и data_users. Создание датасета, где каждой поездке приписана полная информация о пользователе и о подписке
Получен датасет `data_rides_extended` из 18068 строчек, где каждая строчка выглядит так:
![image.png](attachment:cb7fa405-a494-43a1-8702-6301095a7ff4.png)
Датасет `data_rides_extended` разделен на два датасета:
- free_users_rides (хранит поездки пользователей без подписки)
- ultra_users_rides (хранит поездки пользователей с подпиской)
## Анализ длительности и расстояния поездки в зависимости от подписки
###! Могу написать лучше

**Расстояние поездки и длительность в зависимости от подписки кратко** 

Явно заметно, что пользователи с подпиской в два раза реже совершают короткие поездки длительностью (__до 10 минут и до 2-х киллометров__), а также в __1.7 раза чаще__ ездят на расстояния __от 3-х до 4-х киллометров__ чем пользователи без подписки
 
**Расстояние поездки в зависимости от подписки подробно** 

Можно сразу сказать, что пользователи с подпиской в __два раза реже__  ездет на расстояния менее __2-х киллометров__ и на расстояния от __4-х до 5 киллометром__, а также в __1.7 раза__ чаще ездят на на расстояния от __3-х до 4 киллометров__

Ниже более подробные данные

Выводы относительно расстояния, которое проезжают пользователи без подписки за одну поездку:
- Максимальное расстояние поездки пользователей с подпиской __меньше 7 км__
- __17%__ пользователей без подписки проезжают меньше __2-х километров__ за поездку
- Примерно __29%__ пользователей без подписки проезжает от __2-х до 3-х километров__ за поездку
- __31%__ пользователей без подписки проезжает от __3-х до 4-х километров__ за поездку
- Примерно __29%__ пользователей без подписки проезжает от __4-х до 5-х километров__ за поездку
- Примерно __5%__ пользователей без подписки проезжает больше __5-х километров__ за поездку


Выводы относительно расстояния, которое проезжают пользователи с подпиской за одну поездку
- Максимальное расстояние поездки пользователей с подпиской меньше __5 км__
- __9%__ пользователей с подпиской проезжают меньше __2-х километров__ за поездку
- Примерно __30%__ пользователей с подпиской проезжает от __2-х до 3-х километров__ за поездку
- __49%__ пользователей с подпиской проезжает от __3-х до 4-х километров__ за поездку
- Примерно __12%__ пользователей с подпиской проезжает от __4-х до 5-х километров__ за поездку
 
 
**Длительность поездки в зависимости от подписки подробно** 
 
Можно сразу сказать, что пользователи с подпиской
- В __три раза реже__ совершают поздки __короче 10 минут__
- В __1.1 раза чаще__ совершают поздки длительностью __от 15 до 30 минут__
- В __1.3 раза чаще__ совершают поздки длительностью __более 30 минут__


Ниже более подробные данные

Выводы относительно времени, которое пользователи без подписки затрачивают на одну поездку:
- Максимальное время поездки пользователей с подпиской __меньше 36 м__
- __9%__ пользователей совершают поездки длительностью до __10 минут__ 
- __21%__ пользователей совершают поездки длительностью __от 10 до 15 минут__
- __62%__ пользователей совершают поездки длительностью __от 15 до 30 минут__
- __3.5%__ пользователей совершают поездки длительностью __от 30 минут__

Выводы относительно времени, которое пользователи с подпиской затрачивают на одну поездку:
- Максимальное время поездки пользователей с подпиской __меньше 41 м__
- __3%__ пользователей совершают поездки длительностью до __10 минут__ 
- __19%__ пользователей совершают поездки длительностью __от 10 до 15 минут__
- __73%__ пользователей совершают поездки длительностью __от 15 до 30 минут__
- __4%__ пользователей совершают поездки длительностью __от 30 минут__

## Создание датафрейма, где для каждого пользователя указано, какое суммарное расстояние, количество поездок, суммарное время поездок было сделано пользователем за месяц, а также указано сколько денег он принес
Создали датафрейм `users_rides_month_info`, где для каждого пользователя указано, какое суммарное расстояние, количество поездок, суммарное время поездок было сделано пользователем за месяц, а также указано сколько денег он принес компании за этот месяц. Каждая строчка выглядит так
![image.png](attachment:77178696-86b0-48d2-b31a-64240d58de30.png)
## Проверка гипотез
**"Результат проверки гипотезы "Пользователи с подпиской ездят дольше чем пользователи без подписки""** 

Отвергаем гипотезу "Пользователи с подпиской тратят столько же или меньше времени на поездки, чем пользователи без подписки" в пользу гипотезы  
"Пользователи с подпиской тратят больше времени на поездки, чем пользователи без подписки"

**"Результат проверки гипотезы "Пользователи с подпиской в среднем ездят меньше чем на 3130 метров за поездку"** 

Гиппотеза про то, что среднее расстояние, которое проезжают пользователи с подпиской за одну поездку, не превышает 3130 метров с большей вероятностью верна, чем не верна

**"Результат проверки гипотезы "Помесячная выручка от пользователей с подпиской выше чем от пользователей без подписки"**
 
Отвергаем гипотезу "Помесячная Выручка от пользователей с подпиской меньше или равна, чем выручка от пользователей без подписки" в пользу гипотезы "Помесячная Выручка от пользователей с подпиской больше, чем выручка от пользователей без подписки". Это значит, что пользователи с подпиской приносят больше дохода компании

**"Результат выполнения задания по гипотезе "После обновления серверов в поддержку стало приходить меньше запросов"**
 
Для проверики гипотезы "После обновления серверов в поддержку стало приходить меньше запросов" стоит использовать тест scipy.stats.ttest_rel()
## Проверка вероятностей успеха двух событий: акции "Бесплатная подписка 30 дней" и открытия пуша более 399,5 тысячами пользователей
**Вероятность успеха акции "Бесплатная подписка 30 дней"** 

Чтобы как минимум 100 пользователей продлило подписку после бесплатного пробного периода, нужно раздать 1161 промокод на беслатный пробный период. И это все с учетом того, что каждый из пользователей активирует промокод, а также продлит его с вероятностью 10%

**Вероятность открытия пуша более чем 399.5 тысячами пользователей** 

Если уведомления открывают около 40 % получивших клиентов. А планируется разослать 1 млн уведомлений, вероятность того, что уведомление откроет не более 399,5 тыс. пользователей: 15.4%.

## Рекомендации по сбору данных
1. Нужно проверить функции входа и регистрации, так чтобы в базе данных не создавались аккаунты дубликаты. Это также может быть проблема записи данных и выгрузки данных
2. Нужно узнать почему зимой не наблюдается спада в поездках
3. Возможно, для того, чтобы не хранить неважную информацию, стоит записывать меньше данных о слишком коротких (меньше 100 метром, 1 минуты) поздках. Например, только их количество


# ТЗ

Проект: Статистический анализ данных
======================================

Вы аналитик популярного сервиса аренды самокатов GoFast. Вам передали данные о некоторых пользователях из нескольких городов, а также об их поездках. Проанализируйте данные и проверьте некоторые гипотезы, которые могут помочь бизнесу вырасти.

Чтобы совершать поездки по городу, пользователи сервиса GoFast пользуются мобильным приложением. Сервисом можно пользоваться:

- без подписки  
  абонентская плата отсутствует;  
  стоимость одной минуты поездки — 8 рублей;  
  стоимость старта (начала поездки) — 50 рублей;
- с подпиской Ultra  
  абонентская плата — 199 рублей в месяц;  
  стоимость одной минуты поездки — 6 рублей;  
  стоимость старта — бесплатно.

Описание данных
---------------

В основных данных есть информация о пользователях, их поездках и подписках.

### Пользователи — users_go.csv

- **user_id** — уникальный идентификатор пользователя
- **name** — имя пользователя
- **age** — возраст
- **city** — город
- **subscription_type** — тип подписки (free, ultra)

### Поездки — rides_go.csv

- **user_id** — уникальный идентификатор пользователя
- **distance** — расстояние, которое пользователь проехал в текущей сессии (в метрах)
- **duration** — продолжительность сессии (в минутах) — время с того момента, как пользователь нажал кнопку «Начать поездку» до момента, как он нажал кнопку «Завершить поездку»
- **date** — дата совершения поездки

### Подписки — subscriptions_go.csv

- **subscription_type** — тип подписки
- **minute_price** — стоимость одной минуты поездки по данной подписке
- **start_ride_price** — стоимость начала поездки
- **subscription_fee** — стоимость ежемесячного платежа

Шаг 1. Загрузка данных
-----------------------

1.1 Считайте CSV-файлы с данными с помощью библиотеки pandas и сохраните их в датафреймы. Пути к файлам:  
`/datasets/users_go.csv`  
`/datasets/rides_go.csv`  
`/datasets/subscriptions_go.csv`

1.2 Выведите первые строки каждого набора данных. Изучите общую информацию о каждом датафрейме.

Шаг 2. Предобработка данных
---------------------------

2.1 Приведите столбец date к типу даты pandas.

2.2 Создайте новый столбец с номером месяца на основе столбца date.

2.3 Проверьте наличие пропущенных значений и дубликатов в датафреймах. Обработайте их, если такие значения присутствуют.

Шаг 3. Исследовательский анализ данных
---------------------------------------

Опишите и визуализируйте общую информацию о пользователях и поездках:

3.1 частота встречаемости городов;  
3.2 соотношение пользователей с подпиской и без подписки;  
3.3 возраст пользователей;  
3.4 расстояние, которое пользователь преодолел за одну поездку;  
3.5 продолжительность поездок.

Шаг 4. Объединение данных
-------------------------

4.1 Объедините данные о пользователях, поездках и подписках в один датафрейм. Для этого воспользуйтесь методом merge().

4.2 Создайте ещё два датафрейма из датафрейма, созданного на этапе 4.1:  
  - c данными о пользователях без подписки;  
  - с данными о пользователях с подпиской.

4.3 Визуализируйте информацию о расстоянии и времени поездок для пользователей обеих категорий.

Шаг 5. Подсчёт выручки
----------------------

5.1 Создайте датафрейм с агрегированными данными о поездках на основе датафрейма с объединёнными данными из шага 4: найдите суммарное расстояние, количество поездок и суммарное время для каждого пользователя за каждый месяц.

5.2 В этот же датафрейм добавьте столбец с помесячной выручкой, которую принёс каждый пользователь. Для этого обратитесь к информации об условиях оплаты для подписчиков и тех, у кого нет подписки. Продолжительность каждой поездки в каждой строке исходного датафрейма для подсчёта стоимости округляется до следующего целого числа: например, значения 25.3, 25.5 и 26.0 должны быть преобразованы к 26.

Шаг 6. Проверка гипотез
-----------------------

Продакт-менеджеры сервиса хотят увеличить количество пользователей с подпиской. Для этого они будут проводить различные акции, но сначала нужно выяснить несколько важных моментов.

6.1 Важно понять, тратят ли пользователи с подпиской больше времени на поездки? Если да, то пользователи с подпиской могут быть «выгоднее» для компании. Проверьте гипотезу. Используйте исходные данные о продолжительности каждой сессии — отдельно для подписчиков и тех, у кого нет подписки.

6.2 Расстояние одной поездки в 3130 метров — оптимальное с точки зрения износа самоката. Можно ли сказать, что среднее расстояние, которое проезжают пользователи с подпиской за одну поездку, не превышает 3130 метров? Проверьте гипотезу и сделайте выводы.

6.3 Проверьте гипотезу о том, будет ли помесячная выручка от пользователей с подпиской по месяцам выше, чем выручка от пользователей без подписки. Сделайте вывод.

6.4 Представьте такую ситуацию: техническая команда сервиса обновила сервера, с которыми взаимодействует мобильное приложение. Она надеется, что из-за этого количество обращений в техподдержку значимо снизилось. Некоторый файл содержит для каждого пользователя данные о количестве обращений до обновления и после него. Какой тест вам понадобился бы для проверки этой гипотезы?

Шаг 7 (необязательное задание). Распределения
-------------------------------------------

7.1 Отделу маркетинга GoFast поставили задачу: нужно провести акцию с раздачей промокодов на один бесплатный месяц подписки, в рамках которой как минимум 100 существующих клиентов должны продлить эту подписку. То есть по завершении периода действия подписки пользователь может либо отказаться от неё, либо продлить, совершив соответствующий платёж.  
Эта акция уже проводилась ранее и по итогу выяснилось, что после бесплатного пробного периода подписку продлевают 10 % пользователей. Выясните, какое минимальное количество промокодов нужно разослать, чтобы вероятность не выполнить план была примерно 5 %. Подберите параметры распределения, описывающего эту ситуацию, постройте график распределения и сформулируйте ответ на вопрос о количестве промокодов.

7.2 Отдел маркетинга рассылает клиентам push-уведомления в мобильном приложении. Клиенты могут открыть его или не открывать. Известно, что уведомления открывают около 40 % получивших клиентов. Отдел планирует разослать 1 млн уведомлений. С помощью аппроксимации постройте примерный график распределения и оцените вероятность того, что уведомление откроют не более 399,5 тыс. пользователей.



# Технический комментарий
- Версия с опциональной критикой без правок. Немного почистил комментарии и удалил ненужные библиотеки. Больше ничего не менял
- Emerald